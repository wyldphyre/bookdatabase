{% extends "base.html" %}

{% block title %}Authors - Book Database{% endblock %}

{% block content %}
<header>
    <hgroup>
        <h1>Authors</h1>
        <p>{{ authors.total }} author{{ 's' if authors.total != 1 else '' }}{% if search %} matching "{{ search }}"{% endif %}</p>
    </hgroup>
    <a href="{{ url_for('author_new') }}" role="button">Add New Author</a>
</header>

<div style="margin-top: 1rem;"></div>

<form action="{{ url_for('author_list') }}" method="get">
    <input type="search" name="search" id="author-list-search" placeholder="Search authors..." value="{{ search }}"
           hx-get="{{ url_for('author_list') }}"
           hx-trigger="keyup changed delay:300ms"
           hx-target="#author-results"
           hx-select="#author-results"
           hx-push-url="true">
</form>

<div id="author-results">

{% if authors.items %}
    <div class="author-grid">
        {% for author in authors.items %}
        <div class="author-card">
            <div class="author-info">
                <a href="{{ url_for('author_detail', id=author.id) }}"><strong>{{ author.name }}</strong></a>
                {% if author.pronouns %}<small>({{ author.pronouns }})</small>{% endif %}
                {% if author.gender %}<br><small class="secondary">{{ author.gender.name }}</small>{% endif %}
                {% set book_count = author.books|length %}
                {% set series_count = author.books|unique_series_count %}
                <br><small>{{ book_count }} book{{ 's' if book_count != 1 else '' }}{% if series_count %}, {{ series_count }} series{% endif %}</small>
            </div>
            <div class="button-group">
                <a href="{{ url_for('author_edit', id=author.id) }}" role="button" class="outline secondary small">Edit</a>
            </div>
        </div>
        {% endfor %}
    </div>

{% if authors.pages > 1 %}
<nav class="pagination">
    {% if authors.has_prev %}
    <a href="{{ url_for('author_list', page=authors.prev_num, per_page=per_page, search=search) }}">Previous</a>
    {% endif %}

    {% for page in authors.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if page %}
            {% if page == authors.page %}
            <span class="current">{{ page }}</span>
            {% else %}
            <a href="{{ url_for('author_list', page=page, per_page=per_page, search=search) }}">{{ page }}</a>
            {% endif %}
        {% else %}
        <span>...</span>
        {% endif %}
    {% endfor %}

    {% if authors.has_next %}
    <a href="{{ url_for('author_list', page=authors.next_num, per_page=per_page, search=search) }}">Next</a>
    {% endif %}
</nav>
{% endif %}

{% else %}
    <article>
        <p>{% if search %}No authors found matching "{{ search }}".{% else %}No authors yet.{% endif %}</p>
        <a href="{{ url_for('author_new') }}" role="button">Add Your First Author</a>
    </article>
{% endif %}
</div>
{% endblock %}
