{% extends "base.html" %}

{% block title %}Dashboard - Book Database{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<div class="stats">
    <div class="stat">
        <div class="stat-value">{{ total_books }}</div>
        <div class="stat-label">Total Books</div>
    </div>
    <div class="stat">
        <div class="stat-value">{{ total_reads }}</div>
        <div class="stat-label">Completed Reads</div>
    </div>
    <div class="stat">
        <div class="stat-value">{{ active_reads|length }}</div>
        <div class="stat-label">Currently Reading</div>
    </div>
</div>

<h2>Currently Reading</h2>

{% if active_reads %}
    {% for read in active_reads %}
    <div class="active-read-card">
        {% if read.book.cover_image %}
        <img src="{{ url_for('static', filename='uploads/' + read.book.cover_image) }}" alt="{{ read.book.title }}">
        {% else %}
        <div class="active-read-placeholder">ðŸ“š</div>
        {% endif %}
        <div style="flex: 1;">
            <h3 style="margin: 0;">
                <a href="{{ url_for('book_detail', id=read.book.id) }}">{{ read.book.title }}</a>
            </h3>
            {% if read.book.authors %}
            <p style="margin: 0.25rem 0; color: var(--pico-muted-color);">
                {% for author in read.book.authors %}
                <a href="{{ url_for('author_detail', id=author.id) }}">{{ author.name }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
            {% endif %}
            {% if read.book.series %}
            <p style="margin: 0.25rem 0;">
                <a href="{{ url_for('series_detail', id=read.book.series.id) }}">{{ read.book.series.name }}</a>
                {% if read.book.series_number %}#{{ read.book.series_number }}{% endif %}
            </p>
            {% endif %}
            <div style="margin-top: 0.5rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <div>
                    {% if read.start_date %}
                    <small>Started: {{ read.start_date.strftime('%B %d, %Y') }} ({{ read.start_date|days_since }} days ago)</small>
                    {% endif %}
                    {% if read.book.page_count %}
                    <small> | {{ read.book.page_count }} pages</small>
                    {% endif %}
                </div>
                <form method="post" action="{{ url_for('read_complete', id=read.id) }}" style="margin: 0;">
                    <button type="submit" class="outline small" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin: 0;">Mark Complete</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <article>
        <p>You're not currently reading any books.</p>
        <a href="{{ url_for('book_list') }}" role="button">Browse Books</a>
    </article>
{% endif %}
{% endblock %}
