{% extends "base.html" %}

{% block title %}Series - Book Database{% endblock %}

{% block content %}
<header>
    <hgroup>
        <h1>Series</h1>
        <p>Browse and manage book series</p>
    </hgroup>
    <a href="{{ url_for('series_new') }}" role="button">Add New Series</a>
</header>

<form action="{{ url_for('series_list') }}" method="get">
    <input type="search" name="search" id="series-list-search" placeholder="Search series..." value="{{ search }}"
           hx-get="{{ url_for('series_list') }}"
           hx-trigger="keyup changed delay:300ms"
           hx-target="#series-results"
           hx-select="#series-results"
           hx-push-url="true">
</form>

<div id="series-results">

{% if series_list %}
    {% for series in series_list %}
    <div class="series-list-item">
        <div class="series-header">
            <div class="series-info">
                <a href="{{ url_for('series_detail', id=series.id) }}"><strong>{{ series.name }}</strong></a>
                {% if series.number_in_series %}
                <small>({{ series.number_in_series }} books in series)</small>
                {% endif %}
                <br>
                <small>{{ series.books|length }} book{{ 's' if series.books|length != 1 else '' }} in library</small>
            </div>
            <a href="{{ url_for('series_edit', id=series.id) }}" role="button" class="outline secondary small">Edit</a>
        </div>
        {% if series.books %}
        <div class="series-covers">
            {% for book in series.books|sort_by('series_number') %}
            <a href="{{ url_for('book_detail', id=book.id) }}" class="series-cover-link" title="{{ book.title }}{% if book.series_number %} (#{{ book.series_number }}){% endif %}">
                {% if book.cover_image %}
                <img src="{{ url_for('static', filename='uploads/' + book.cover_image) }}" alt="{{ book.title }}">
                {% else %}
                <div class="series-cover-placeholder">{{ book.title[0] }}</div>
                {% endif %}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <article>
        <p>{% if search %}No series found matching "{{ search }}".{% else %}No series yet.{% endif %}</p>
        <a href="{{ url_for('series_new') }}" role="button">Add Your First Series</a>
    </article>
{% endif %}
</div>
{% endblock %}
